<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	data-layout-decorate="~{fragments/main}">
<head>
<html>
<head>
<title>Register</title>

</head>
<body>

	<div data-layout-fragment="content">
	
	
		<div class="pricing-header px-3 pt-md-5 pb-md-4 mx-auto text-center">
			<h1 class="display-4">Create a question</h1>
			<p class="lead">In field below define your question, answers and
				assign individual members or teams.</p>
		</div>


		<form th:action="@{/profile/addQuestion}" method="post"
			th:object="${request}">
			<div class="card border-primary border-light shadow">
				<div class="card-header">
					<input class="form-control invisible-form-control"
						required="required" placeholder="Type your question here*"
						th:field="*{text}" /> <small id="optionError"
						class="text text-danger" th:if="${#fields.hasErrors('text')}"
						th:errors="*{text}"></small>
				</div>


				<div class="card-body m-0 text-center">
					<small class="text-muted mb-1 d-block">Type in to add
						optional answers*</small>


					<div class="input-group">
						<input type="text" id="in" class="form-control"
							placeholder="Type your option here"
							aria-label="Recipient's username" aria-describedby="basic-addon2" />
						<div class="input-group-append">
							<button class="btn btn-secondary" type="button"
								onclick="clicked()">Add option</button>
						</div>

					</div>
					<small id="optionError" class="text text-danger"
						th:if="${#fields.hasErrors('optionParams')}"
						th:errors="*{optionParams}"></small>
				</div>

				<div class="px-3">
					<div class="btn-group d-flex">
						<a href="/profile" class="w-100 btn btn-outline-secondary">Cancel</a>
						<input type="submit" class="w-100 btn btn-secondary"
							value="Create question" />

					</div>

				</div>

				<div id="options" class="p-2 text-center">
					<small id="optionInfo" class="text-muted mb-1 d-block">Click
						on option to delete</small>
				</div>


			</div>

		</form>



		<script type="text/javascript">
			$(document).ready(function(event) {
				console.log("ready!");
				$('#optionInfo').css("visibility", "hidden");
				
				/*
				* Binding enter key to keyup, and prevent form enter key presed
				*/
				$(window).keydown(function(event){
				    if(event.keyCode == 13) {
				      event.preventDefault();
				      return false;
				    }
				  });
				
				$('#in').keyup(function(event){
				    if(event.keyCode == 13)
				    {
				    	clicked();
				    }
				});
				
			});

			function clicked() {
				var input = $("#in");
				var text = input.val();

				if (text.trim() === '') {
					console.log('cant be empty');
					return;
				}

				input.val("");

				var options = $("#options");
				var customDiv = $("<input name='optionParams' th:field='k*{optionParams}' class='btn btn-md btn-outline-secondary mb-1 mr-1' readonly onclick='deleteOption(event)''/>");
				customDiv.val(text);

				options.append(customDiv);
				$('#optionInfo').css("visibility", "visible");
				$('#optionError').css("visibility", "hidden");

			}

			function deleteOption(event) {
				var option = event.target;
				console.log(option);
				option.remove();

				var options = $("#options > input").length;
				if (options == 0) {
					$('#optionInfo').css("visibility", "hidden");
				}
			}
			
			
		</script>


	</div>
</body>
</html>